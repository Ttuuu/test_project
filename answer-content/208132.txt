<div class="s-prose s-prose__disable-spoiler-hover js-post-body" itemprop="text">
<p>Both your and Henrik's approach can be optimized by replacing <code>stream.ToArray()</code> with <a href="https://docs.microsoft.com/en-us/dotnet/api/system.io.memorystream.getbuffer?view=netframework-4.7.2" rel="nofollow noreferrer"><code>stream.GetBuffer()</code></a>. This returns the <code>MemoryStream</code>'s internal buffer array instead of making a copy.</p>

<p>You do have to take into account that the buffer can be larger than the actual data, so use the <code>Length</code> of the stream, not of the buffer. It's also possible that the data doesn't start at index 0, but that's only the case if you used one of the <code>MemoryStream</code> constructors that accepts an array, index and count. No problem here, but something to keep in mind if you want to generalize this.</p>
    </div>