<div class="s-prose s-prose__disable-spoiler-hover js-post-body" itemprop="text">
<p>I have not completely thought this through but noticed that the swaps only occur in rows. Could you do this first row-by-row, recording the depth somehow, and then combine these row results with filtering out those with cumulative depth greater than the required depth?</p>
    </div>