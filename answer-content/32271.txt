<div class="s-prose s-prose__disable-spoiler-hover js-post-body" itemprop="text">
<p>As suggested, I tried using a gem like <a href="https://github.com/pluginaweek/state_machine" rel="nofollow noreferrer">state_machine</a>.  Well, not a gem <em>like</em> state_machine, but that particular gem.  The state machine defintion is:</p>

<pre><code>    state_machine :state, :initial =&gt; :idle do

      event :iac do
        transition :idle =&gt; :iac
        transition :iac =&gt; :idle
        transition [:will, :wont, :do, :dont] =&gt; :idle
      end

      event :will do
        transition :iac =&gt; :will
        transition :will =&gt; :idle
      end

      event :dm do
        transition :iac =&gt; :idle
      end

      event :ip do
        transition :iac =&gt; :idle
      end

      event :dont do
        transition :iac =&gt; :dont
      end

      event :other do
        transition all =&gt; :idle
      end

      event :do do
        transition :iac =&gt; :do
      end

      event :wont do
        transition :iac =&gt; :wont
      end

      before_transition :from =&gt; :do, :to =&gt; :idle, :do =&gt; :send_wont
      before_transition :from =&gt; :will, :to =&gt; :idle, :do =&gt; :send_dont
      before_transition :from =&gt; :idle, :to =&gt; :idle, :do =&gt; :accept_plain
      before_transition :from =&gt; :iac, :to =&gt; :idle, :on =&gt; :other, :do =&gt; :accept_unknown_iac
      before_transition :from =&gt; :iac, :to =&gt; :idle, :on =&gt; :iac, :do =&gt; :accept_plain

    end
</code></pre>

<p>The state_machine DSL is clean and relatively compact.  Unfortunately, it is organized around events that cause transitions, rather than states that have transitions.  That's not bad, but it's completely inside-out to how I think about state machines.  It also makes you define actions separately from the transitions.  The net result is that I can't see the state machine from this definition.</p>

<p>However, the state_machine gem has a rake task to generate a state diagram directly from the code.  Here's what it generated for the above code:</p>

<p><img src="https://i.stack.imgur.com/GQZS6.png" alt="state diagram"></p>

<p>Other than the lack of actions, the state diagram generated by state_machine is very nice.</p>
    </div>